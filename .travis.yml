language: cpp

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test

before_script:
  - mkdir build
  - cd build
  - cmake ..
  - make

script:
  - ./xeus-fift-test

before_deploy:
  - export XFIFT_VERSION=$(bash /xeus-fift/scripts/xfift_version.sh)
  - echo "Jupyter kernel for the Fift language\n" > description-pak
  - fakeroot checkinstall \
    --arch="amd64" \
    --pkgname="xeus-fift" \
    --pkgversion=$XFIFT_VERSION \
    --pkgrelease="1" \
    --pkglicense="GPL-3" \
    --pkgsource="https://github.com/m-kus/xeus-fift" \
    --maintainer="mz@baking-bad.org" \
    --install=no -y -D -d2 make install

deploy:
  provider: releases
  api_key: $GH_TOKEN
  file: xeus-fift_$XFIFT_VERSION-1_amd64.deb
  skip_cleanup: true
  draft: true
  on:
    branch: master
    type: push